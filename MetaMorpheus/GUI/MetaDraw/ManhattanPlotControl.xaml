<UserControl x:Class="MetaMorpheusGUI.ManhattanPlotControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MetaMorpheusGUI"
             xmlns:oxy="http://oxyplot.org/wpf"
             xmlns:parallelSearch="clr-namespace:GuiFunctions.ViewModels.ParallelSearchTask;assembly=GuiFunctions"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800"
             d:DataContext="{d:DesignInstance parallelSearch:ManhattanPlotViewModel, IsDesignTimeCreatable=True}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" MinHeight="300" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Manhattan Plot -->
        <Border Grid.Row="0" BorderBrush="LightGray" BorderThickness="1" Margin="5">
            <Grid>
                <oxy:PlotView x:Name="ManhattanPlotView" 
                              Model="{Binding PlotModel}"
                              FontSize="14" 
                              FontStretch="Expanded" 
                              VerticalAlignment="Stretch"
                              Margin="5" />
                
                <!-- Export buttons overlay -->
                <StackPanel Orientation="Horizontal" 
                           HorizontalAlignment="Right" 
                           VerticalAlignment="Top"
                           Margin="10">
                    <Button Content="Export Data" 
                            Command="{Binding ExportPlotDataCommand}"
                            Width="90" Height="26" 
                            Margin="0 0 5 0"
                            ToolTip="Export plot data to CSV" />
                    <Button Content="Refresh" 
                            Command="{Binding RefreshPlotCommand}"
                            Width="70" Height="26"
                            ToolTip="Refresh the plot" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Plot Options Expander -->
        <Expander Grid.Row="1" IsExpanded="True" ExpandDirection="Down" Margin="5 0">
            <Expander.Header>
                <TextBlock Text="Plot Options" FontWeight="Bold" FontSize="14" />
            </Expander.Header>
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Test Selection -->
                <Label Grid.Row="0" Grid.Column="0" Content="Select Test:" 
                       VerticalAlignment="Center" Margin="0 5" />
                <ComboBox Grid.Row="0" Grid.Column="1" 
                          ItemsSource="{Binding AvailableTests}"
                          SelectedItem="{Binding SelectedTest}"
                          Height="26" Margin="5"
                          ToolTip="Select a specific statistical test to display (or leave blank for all tests)">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- Alpha Threshold -->
                <Label Grid.Row="1" Grid.Column="0" Content="Significance Threshold (Î±):" 
                       VerticalAlignment="Center" Margin="0 5" />
                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="5">
                    <TextBox Text="{Binding Alpha, StringFormat=F3, UpdateSourceTrigger=PropertyChanged}" 
                             Width="80" VerticalContentAlignment="Center" Height="26" />
                    <TextBlock Text="(default: 0.05)" 
                               VerticalAlignment="Center" 
                               Foreground="Gray" 
                               Margin="10 0 0 0" />
                </StackPanel>

                <!-- Use Q-Value -->
                <CheckBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                          Content="Use Q-value (FDR-corrected) instead of P-value"
                          IsChecked="{Binding UseQValue}"
                          VerticalAlignment="Center" 
                          Margin="0 10" />

                <!-- Show Legend -->
                <CheckBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                          Content="Show Legend"
                          IsChecked="{Binding ShowLegend}"
                          VerticalAlignment="Center" 
                          Margin="0 5" />
            </Grid>
        </Expander>

    </Grid>
</UserControl>
