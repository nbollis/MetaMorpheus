<UserControl x:Class="MetaMorpheusGUI.ManhattanPlotControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MetaMorpheusGUI"
             xmlns:oxy="http://oxyplot.org/wpf"
             xmlns:parallelSearch="clr-namespace:GuiFunctions.ViewModels.ParallelSearchTask;assembly=GuiFunctions"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800"
             d:DataContext="{d:DesignInstance parallelSearch:ManhattanPlotViewModel, IsDesignTimeCreatable=True}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" MinHeight="300" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Manhattan Plot -->
        <Border Grid.Row="0" BorderBrush="LightGray" BorderThickness="1" Margin="5">
            <Grid>
                <oxy:PlotView x:Name="ManhattanPlotView" 
                              Model="{Binding PlotModel}"
                              FontSize="14" 
                              FontStretch="Expanded" 
                              VerticalAlignment="Stretch"
                              HorizontalAlignment="Stretch"
                              Margin="2" />
                
                <!-- Export buttons overlay -->
                <StackPanel Orientation="Horizontal" 
                           HorizontalAlignment="Right" 
                           VerticalAlignment="Bottom"
                           Margin="10">
                    <Button Content="Export Data" 
                            Command="{Binding ExportPlotDataCommand}"
                            Width="90" Height="26" 
                            Margin="0 0 5 0"
                            ToolTip="Export plot data to CSV" />
                    <Button Content="Refresh" 
                            Command="{Binding RefreshPlotCommand}"
                            Width="70" Height="26"
                            ToolTip="Refresh the plot" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Plot Options Expander -->
        <Expander Grid.Row="1" IsExpanded="True" ExpandDirection="Down" Margin="5 0">
            <Expander.Header>
                <TextBlock Text="Plot Options" FontWeight="Bold" FontSize="14" />
            </Expander.Header>
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Left Column: Settings -->
                <!-- Alpha Threshold -->
                <Label Grid.Row="0" Grid.Column="0" Content="Significance Threshold (Î±):" 
                       VerticalAlignment="Center" Margin="0 2" />
                <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Margin="5 2">
                    <TextBox Text="{Binding Alpha, StringFormat=F3, UpdateSourceTrigger=PropertyChanged}" 
                             Width="60" VerticalContentAlignment="Center" Height="24" />
                    <TextBlock Text="(default: 0.05)" 
                               VerticalAlignment="Center" 
                               Foreground="Gray" 
                               FontSize="10"
                               Margin="5 0 0 0" />
                </StackPanel>

                <!-- Select Test -->
                <Label Grid.Row="0" Grid.Column="2" Content="Select Test:" 
                       VerticalAlignment="Center" Margin="10 2 0 2" />
                <ComboBox Grid.Row="0" Grid.Column="3" 
                          ItemsSource="{Binding AvailableTests}"
                          SelectedItem="{Binding SelectedTest}"
                          Height="24"
                          Margin="5 2"
                          ToolTip="Select a specific statistical test to display">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- Top N Groups -->
                <Label Grid.Row="1" Grid.Column="0" Content="Top N Groups for Legend:" 
                       VerticalAlignment="Center" Margin="0 2" />
                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="5 2">
                    <TextBox Text="{Binding TopNGroups, UpdateSourceTrigger=PropertyChanged}" 
                             Width="60" VerticalContentAlignment="Center" Height="24" />
                    <TextBlock Text="(0 = show all)" 
                               VerticalAlignment="Center" 
                               Foreground="Gray" 
                               FontSize="10"
                               Margin="5 0 0 0" />
                </StackPanel>

                <!-- Taxonomic Grouping -->
                <Label Grid.Row="1" Grid.Column="2" Content="Group By (Taxonomy):" 
                       VerticalAlignment="Center" Margin="10 2 0 2" />
                <ComboBox Grid.Row="1" Grid.Column="3" 
                          SelectedItem="{Binding GroupBy}"
                          Height="24"
                          Margin="5 2"
                          ToolTip="Select taxonomic level for color grouping">
                    <ComboBox.Items>
                        <parallelSearch:TaxonomicGrouping>Organism</parallelSearch:TaxonomicGrouping>
                        <parallelSearch:TaxonomicGrouping>Kingdom</parallelSearch:TaxonomicGrouping>
                        <parallelSearch:TaxonomicGrouping>Phylum</parallelSearch:TaxonomicGrouping>
                        <parallelSearch:TaxonomicGrouping>Class</parallelSearch:TaxonomicGrouping>
                        <parallelSearch:TaxonomicGrouping>Order</parallelSearch:TaxonomicGrouping>
                        <parallelSearch:TaxonomicGrouping>Family</parallelSearch:TaxonomicGrouping>
                        <parallelSearch:TaxonomicGrouping>Genus</parallelSearch:TaxonomicGrouping>
                        <parallelSearch:TaxonomicGrouping>Species</parallelSearch:TaxonomicGrouping>
                        <parallelSearch:TaxonomicGrouping>None</parallelSearch:TaxonomicGrouping>
                    </ComboBox.Items>
                </ComboBox>

                <!-- Use Q-Value Checkbox -->
                <CheckBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                          Content="Use Q-value (FDR-corrected) instead of P-value"
                          IsChecked="{Binding UseQValue}"
                          VerticalAlignment="Center" 
                          Margin="0 5" />

                <!-- Show Legend Checkbox -->
                <CheckBox Grid.Row="2" Grid.Column="2" Grid.ColumnSpan="2"
                          Content="Show Legend"
                          IsChecked="{Binding ShowLegend}"
                          VerticalAlignment="Center" 
                          Margin="10 5 0 5" />
            </Grid>
        </Expander>

    </Grid>
</UserControl>
